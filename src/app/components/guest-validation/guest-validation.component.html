<div class="validation-container">
    <div class="validation-card shadow-lg">
        <!-- Header -->
        <div class="header">
            <h2 class="title">Boda Daniela & John</h2>
            <div class="date-badge">15.08.2026</div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Loading -->
            <div *ngIf="isLoading" class="loader text-center">
                <div class="spinner-border text-gold" role="status"></div>
                <p class="mt-2">Verificando...</p>
            </div>

            <!-- Manual/Camera Selection Mode -->
            <div *ngIf="!isLoading && !isScanning && !guest" class="action-selection text-center fade-in">
                <div class="status-icon" [style.color]="statusColor">
                    <i class="material-icons">{{ statusIcon }}</i>
                </div>
                <h3 class="status-title" [style.color]="statusColor === '#f44336' ? '#f44336' : '#5D4037'">
                    {{ statusMessage }}
                </h3>

                <!-- Mostrar ayuda si hay error de c√°mara -->
                <div *ngIf="statusColor === '#f44336'" class="alert-camera-error mt-2">
                    <small>üí° Tip: Verifica los permisos de c√°mara en tu navegador</small>
                </div>

                <div class="row g-2 mt-3" *ngIf="!isSearchingByName">
                    <div class="col-6">
                        <button class="btn btn-primary-gold w-100 h-100" (click)="startScanner()">
                            <i class="material-icons d-block">photo_camera</i> ESCANEAR QR
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-primary-gold w-100 h-100" (click)="toggleNameSearch()">
                            <i class="material-icons d-block">person_search</i> BUSCAR NOMBRE
                        </button>
                    </div>
                </div>

                <!-- B√∫squeda por Nombre -->
                <div *ngIf="isSearchingByName" class="name-search-container fade-in mt-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="material-icons text-gold">search</i>
                        </span>
                        <input type="text" class="form-control border-start-0 ps-0" [(ngModel)]="searchTerm"
                            (input)="onSearchInput()" placeholder="Escribe nombre del invitado...">
                        <button class="btn btn-outline-secondary" (click)="toggleNameSearch()">
                            <i class="material-icons" style="font-size: 1.2rem;">close</i>
                        </button>
                    </div>

                    <div *ngIf="filteredGuests.length > 0" class="search-results shadow-sm">
                        <div *ngFor="let g of filteredGuests" class="search-item" (click)="selectGuestFromSearch(g)">
                            <div class="search-item-name">{{ g.name }}</div>
                            <i class="material-icons">chevron_right</i>
                        </div>
                    </div>
                    <div *ngIf="searchTerm.length >= 2 && filteredGuests.length === 0" class="no-results-small mt-2">
                        No se encontraron resultados
                    </div>
                </div>

                <div class="divider" *ngIf="!isSearchingByName"><span>O INGRESA ID MANUAL</span></div>

                <div class="form-group" *ngIf="!isSearchingByName">
                    <input type="text" class="form-control-minimal" [(ngModel)]="enteredId"
                        placeholder="ID del invitado" (keyup.enter)="onManualSubmit()">
                    <button class="btn btn-outline-gold w-100 mt-2" (click)="onManualSubmit()">
                        VALIDAR POR ID
                    </button>
                </div>
            </div>

            <!-- Camera Scanner Mode -->
            <div *ngIf="isScanning" class="scanner-wrapper fade-in">
                <div id="reader"></div>
                <button class="btn btn-outline-danger w-100 mt-3" (click)="stopScanner()">
                    CANCELAR C√ÅMARA
                </button>
            </div>

            <!-- Result Mode -->
            <div *ngIf="!isLoading && !isManualMode && !isScanning" class="result-view text-center fade-in">
                <!-- Status Icon -->
                <div class="status-icon-small" [style.color]="statusColor">
                    <i class="material-icons">{{ statusIcon }}</i>
                </div>

                <h3 class="result-status" [style.color]="statusColor">
                    {{ isValid ? '¬°BIENVENIDO!' : statusMessage }}
                </h3>

                <!-- Guest Info Interface -->
                <div *ngIf="guest" class="guest-details-box mt-3">
                    <div class="detail-item">
                        <span class="detail-label">INVITADO</span>
                        <div class="detail-value">{{ guest.name }}</div>
                    </div>

                    <div *ngIf="familyName" class="detail-item">
                        <div class="detail-value gold-italic">{{ familyName }}</div>
                    </div>

                    <div *ngIf="isValid" class="access-tag mt-2">
                        <i class="material-icons">done</i> ASISTENCIA CONFIRMADA
                    </div>
                    <div class="guest-id-small mt-2">ID: {{ guest.id }}</div>
                </div>

                <button class="btn btn-refresh mt-4" (click)="resetValidation()">
                    <i class="material-icons">autorenew</i> OTRO INVITADO
                </button>
            </div>
        </div>

        <div class="footer-simple mt-3 text-center">
            <small>Sistema de Control de Acceso</small>
        </div>
    </div>
</div>